<Window
    AllowsTransparency="True"
    Background="Transparent"
    Height="720"
    MinHeight="400"
    MinWidth="500"
    ResizeMode="CanResizeWithGrip"
    Title="Game of Life"
    Width="1280"
    WindowStartupLocation="CenterScreen"
    WindowStyle="None"
    mc:Ignorable="d"
    x:Class="GameOfLife.View.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <Border
        Background="{StaticResource BgDark}"
        BorderBrush="{StaticResource BorderColor}"
        BorderThickness="1"
        CornerRadius="8">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="40" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>
            <!--  Кастомная Title Bar  -->
            <Border
                Background="{StaticResource BgPanel}"
                BorderBrush="{StaticResource BorderColor}"
                BorderThickness="0,0,0,1"
                CornerRadius="8,8,0,0"
                Grid.ColumnSpan="2"
                Grid.Row="0"
                MouseLeftButtonDown="TitleBar_MouseLeftButtonDown">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>
                    <!--  Иконка и заголовок  -->
                    <StackPanel
                        Grid.Column="0"
                        Margin="12,0,0,0"
                        Orientation="Horizontal"
                        VerticalAlignment="Center">
                        <TextBlock
                            FontSize="18"
                            Margin="0,0,8,0"
                            Text="🎮"
                            VerticalAlignment="Center" />
                        <TextBlock
                            FontSize="14"
                            FontWeight="SemiBold"
                            Style="{StaticResource LabelText}"
                            Text="Game of Life"
                            VerticalAlignment="Center" />
                    </StackPanel>
                    <!--  Кнопки управления окном  -->
                    <StackPanel
                        Grid.Column="2"
                        HorizontalAlignment="Right"
                        Orientation="Horizontal">
                        <!--  Кнопка минимизации  -->
                        <Button
                            Click="MinimizeButton_Click"
                            Height="40"
                            Style="{StaticResource TitleBarButtonStyle}"
                            Width="46"
                            x:Name="MinimizeButton">
                            <Path
                                Data="M 0,0 H 10"
                                Stretch="None"
                                Stroke="{StaticResource TextPrimary}"
                                StrokeThickness="1"
                                VerticalAlignment="Center" />
                        </Button>
                        <!--  Кнопка максимизации/восстановления  -->
                        <Button
                            Click="MaximizeButton_Click"
                            Height="40"
                            Style="{StaticResource TitleBarButtonStyle}"
                            Width="46"
                            x:Name="MaximizeButton">
                            <Path
                                Data="M 0,0 H 10 V 10 H 0 Z"
                                Fill="Transparent"
                                Stretch="None"
                                Stroke="{StaticResource TextPrimary}"
                                StrokeThickness="1"
                                x:Name="MaximizeIcon" />
                        </Button>
                        <!--  Кнопка закрытия  -->
                        <Button
                            Click="CloseButton_Click"
                            Height="40"
                            Style="{StaticResource TitleBarCloseButtonStyle}"
                            Width="46"
                            x:Name="CloseButton">
                            <Path
                                Data="M 0,0 L 10,10 M 10,0 L 0,10"
                                Stretch="None"
                                Stroke="{StaticResource TextPrimary}"
                                StrokeThickness="1" />
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>
            <Grid Grid.Row="1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="320" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>
                <!--  Панель управления  -->
                <Border
                    Background="{StaticResource BgPanel}"
                    BorderBrush="{StaticResource BorderColor}"
                    BorderThickness="0,0,1,0"
                    Grid.Column="0">
                    <ScrollViewer VerticalScrollBarVisibility="Auto">
                        <StackPanel Margin="24,20">
                            <StackPanel Orientation="Horizontal">
                                <!--  Заголовок  -->
                                <TextBlock
                                    Margin="0,0,0,24"
                                    Style="{StaticResource HeaderText}"
                                    Text="Game of Life" />
                                <Button
                                    Click="GameInfoButton_OnClick"
                                    Content="?"
                                    Height="40"
                                    Margin="90,0"
                                    Style="{StaticResource BtnBlue}"
                                    Width="45" />
                            </StackPanel>
                            <!--  Управление  -->
                            <TextBlock
                                Margin="0,0,0,10"
                                Style="{StaticResource LabelText}"
                                Text="УПРАВЛЕНИЕ" />
                            <UniformGrid
                                Columns="2"
                                Margin="0,0,0,10"
                                Rows="2">
                                <Button
                                    Click="BtnStart_Click"
                                    Content="▶  Старт"
                                    Margin="0,0,4,4"
                                    Style="{StaticResource BtnGreen}" />
                                <Button
                                    Click="BtnPause_Click"
                                    Content="⏸  Пауза"
                                    Margin="4,0,0,4"
                                    Style="{StaticResource BtnGold}" />
                                <Button
                                    Click="BtnResume_Click"
                                    Content="⏯  Продолжить"
                                    Margin="0,4,4,4"
                                    Style="{StaticResource BtnBlue}" />
                                <Button
                                    Click="BtnReset_Click"
                                    Content="🔄  Сброс"
                                    Margin="4,4,0,4"
                                    Style="{StaticResource BtnRed}" />
                            </UniformGrid>
                            <Button
                                Click="BtnRecord_Click"
                                Content="⏺  Запись видео"
                                Margin="0,0,0,10"
                                Style="{StaticResource BtnRed}"
                                ToolTip="Записать симуляцию в видео файл"
                                x:Name="BtnRecord" />
                            <!--  Импорт  -->
                            <TextBlock
                                Margin="0,10,0,10"
                                Style="{StaticResource LabelText}"
                                Text="ИМПОРТ" />
                            <Button
                                Click="OpenButton_OnClick"
                                Content="📂 Импорт изображения"
                                Margin="0,0,0,20"
                                x:Name="OpenButton" />
                            <Separator Margin="0,0,0,20" />
                            <!--  Настройки  -->
                            <TextBlock
                                Margin="0,0,0,10"
                                Style="{StaticResource LabelText}"
                                Text="НАСТРОЙКИ" />
                            <TextBlock
                                Margin="0,0,0,4"
                                Style="{StaticResource LabelText}"
                                Text="Размер клеток" />
                            <TextBox
                                Margin="0,0,0,12"
                                Text="{Binding DisplaySettings.CellSize}"
                                x:Name="SizeTextBox" />
                            <TextBlock
                                Margin="0,0,0,4"
                                Style="{StaticResource LabelText}"
                                Text="Плотность клеток" />
                            <TextBox Margin="0,0,0,12" x:Name="DensityTextBox" />
                            <TextBlock
                                Margin="0,0,0,4"
                                Style="{StaticResource LabelText}"
                                Text="Кисть" />
                            <ComboBox
                                ItemsSource="{Binding BrushesRegistry.BrushNames}"
                                Margin="0,0,0,16"
                                SelectedIndex="{Binding BrushesRegistry.SelectedIndex, Mode=TwoWay}" />
                            <!--  Слайдер скорости  -->
                            <TextBlock
                                Margin="0,0,0,4"
                                Style="{StaticResource LabelText}"
                                Text="Скорость симуляции" />
                            <Slider
                                Height="28"
                                IsSnapToTickEnabled="True"
                                Margin="0,0,0,4"
                                Maximum="100"
                                Minimum="10"
                                TickFrequency="10"
                                ToolTip="Изменяет скорость обновления поколений"
                                Value="1"
                                ValueChanged="SpeedSlider_ValueChanged"
                                x:Name="SpeedSlider" />
                            <TextBlock
                                FontSize="11"
                                HorizontalAlignment="Right"
                                Margin="0,0,0,16"
                                Opacity="0.7"
                                Style="{StaticResource LabelText}"
                                Text="{Binding ElementName=SpeedSlider, Path=Value, StringFormat='Текущее значение: {0:F0}'}" />
                            <Separator Margin="0,0,0,20" />
                            <!--  Визуализация  -->
                            <TextBlock
                                Margin="0,0,0,10"
                                Style="{StaticResource LabelText}"
                                Text="ВИЗУАЛИЗАЦИЯ" />
                            <CheckBox
                                Content="Рендеринг по клеткам"
                                Cursor="Help"
                                IsChecked="{Binding DisplaySettings.UseCellRendering}"
                                Margin="0,0,0,10">
                                <CheckBox.ToolTip>
                                    <ToolTip Content="При отключении — отрисовка идёт по каждому пикселю, что может значительно снизить производительность." />
                                </CheckBox.ToolTip>
                            </CheckBox>
                            <CheckBox
                                Content="Показать производительность"
                                IsChecked="True"
                                Margin="0,0,0,10"
                                x:Name="ShowPerformanceCheckBox" />
                            <CheckBox
                                Content="Дополнительные цвета"
                                IsChecked="{Binding UseAdditionalColors}"
                                Margin="0,0,0,12"
                                x:Name="ColorCheckBox" />
                            <TextBlock
                                Margin="0,0,0,4"
                                Style="{StaticResource LabelText}"
                                Text="Цветовая схема"
                                Visibility="{Binding UseAdditionalColors, Converter={StaticResource BooleanToVisibilityConverter}}" />
                            <ComboBox
                                ItemsSource="{Binding DisplaySettings.ColorStrategyNames}"
                                Margin="0,0,0,16"
                                SelectedItem="{Binding DisplaySettings.CurrentColorStrategyName, Mode=TwoWay}"
                                Visibility="{Binding UseAdditionalColors, Converter={StaticResource BooleanToVisibilityConverter}}"
                                x:Name="ThemeComboBox" />
                            <Separator Margin="0,0,0,20" />
                            <!--  Правила  -->
                            <TextBlock
                                Margin="0,0,0,10"
                                Style="{StaticResource LabelText}"
                                Text="ПРАВИЛА ИГРЫ" />
                            <Button
                                Click="OpenNewCellWindow_Click"
                                Content="Менеджер клеток"
                                Margin="0,0,0,12"
                                Style="{StaticResource BtnBlue}" />
                            <Border
                                BorderBrush="{StaticResource BorderColor}"
                                BorderThickness="1"
                                CornerRadius="4"
                                Grid.Column="1"
                                Height="24"
                                HorizontalAlignment="Left"
                                Margin="8,0,0,0"
                                Width="24">
                                <Rectangle
                                    Fill="{Binding MainCellType.Color, Converter={StaticResource ColorToBrushConverter}}"
                                    RadiusX="3"
                                    RadiusY="3" />
                            </Border>
                            <TextBlock
                                Margin="0,0,0,4"
                                Style="{StaticResource LabelText}"
                                Text="Клетка выживает, если соседей:" />
                            <TextBox
                                Margin="0,0,0,12"
                                Text="{Binding MainCellType.BirthRules}"
                                x:Name="SurviveTextBox" />
                            <TextBlock
                                Margin="0,0,0,4"
                                Style="{StaticResource LabelText}"
                                Text="Клетка рождается, если соседей:" />
                            <TextBox
                                Margin="0,0,0,16"
                                Text="{Binding MainCellType.SurvivalRules}"
                                x:Name="BornTextBox" />
                            <Separator Margin="0,0,0,20" />
                        </StackPanel>
                    </ScrollViewer>
                </Border>
                <!--  Область визуализации  -->
                <Border
                    Background="#0A0C10"
                    CornerRadius="0,0,8,0"
                    Grid.Column="1"
                    Padding="16">
                    <Grid>
                        <Border
                            Background="{StaticResource BgCard}"
                            BorderBrush="{StaticResource BorderColor}"
                            BorderThickness="1"
                            CornerRadius="8"
                            Effect="{DynamicResource DropShadow}"
                            Padding="8"
                            SnapsToDevicePixels="True"
                            x:Name="GameBorder">
                            <Image
                                HorizontalAlignment="Center"
                                MouseLeftButtonDown="Field_OnMouseLeftButtonDown"
                                MouseLeftButtonUp="Field_OnMouseLeftButtonUp"
                                MouseMove="Field_OnMouseMove"
                                Stretch="Uniform"
                                VerticalAlignment="Center"
                                x:Name="Field" />
                        </Border>
                        <!--  Панель статистики с фиксированной шириной  -->
                        <Border
                            Background="#CC1A1D24"
                            BorderBrush="#3A7FFF"
                            BorderThickness="1"
                            CornerRadius="6"
                            Effect="{DynamicResource DropShadow}"
                            HorizontalAlignment="Right"
                            Margin="0,8,8,0"
                            Padding="12,8"
                            VerticalAlignment="Top"
                            Visibility="{Binding ElementName=ShowPerformanceCheckBox, Path=IsChecked, Converter={StaticResource BooleanToVisibilityConverter}}"
                            x:Name="PerformancePanel">
                            <StackPanel Width="150">
                                <TextBlock
                                    FontSize="10"
                                    FontWeight="SemiBold"
                                    Foreground="#888"
                                    Margin="0,0,0,6"
                                    Text="ПРОИЗВОДИТЕЛЬНОСТЬ"
                                    TextAlignment="Center" />
                                <StackPanel Margin="0,0,0,4" Orientation="Horizontal">
                                    <TextBlock
                                        FontSize="11"
                                        FontWeight="Medium"
                                        Foreground="#AAA"
                                        Text="GPS:"
                                        Width="65" />
                                    <TextBlock
                                        FontSize="11"
                                        FontWeight="Bold"
                                        Foreground="#0FFF50"
                                        Text="0"
                                        TextAlignment="Right"
                                        Width="70"
                                        x:Name="GpsText" />
                                </StackPanel>
                                <StackPanel Margin="0,0,0,4" Orientation="Horizontal">
                                    <TextBlock
                                        FontSize="11"
                                        FontWeight="Medium"
                                        Foreground="#AAA"
                                        Text="Цикл:"
                                        Width="65" />
                                    <TextBlock
                                        FontSize="11"
                                        FontWeight="Bold"
                                        Foreground="#FFD700"
                                        Text="0.00 мс"
                                        TextAlignment="Right"
                                        Width="70"
                                        x:Name="CycleTimeText" />
                                </StackPanel>
                                <StackPanel Margin="0,0,0,4" Orientation="Horizontal">
                                    <TextBlock
                                        FontSize="11"
                                        FontWeight="Medium"
                                        Foreground="#AAA"
                                        Text="Выполн.:"
                                        Width="65" />
                                    <TextBlock
                                        FontSize="11"
                                        FontWeight="Bold"
                                        Foreground="#FF6B6B"
                                        Text="0.00 мс"
                                        TextAlignment="Right"
                                        Width="70"
                                        x:Name="ExecutionTimeText" />
                                </StackPanel>
                            </StackPanel>
                        </Border>
                    </Grid>
                </Border>
            </Grid>
        </Grid>
    </Border>
</Window>